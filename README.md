# ربات تلگرام تشخیص و یافتن موزیک فارسی

این ربات تلگرام به شما کمک می‌کند تا با ارسال یک قطعه کوتاه از یک آهنگ ریمیکس شده فارسی، نسخه کامل آن را پیدا کنید. ربات با استفاده از فناوری‌های پردازش سیگنال دیجیتال و یادگیری ماشین، قادر به تشخیص آهنگ‌ها حتی در حالت ریمیکس شده است.

## ویژگی‌ها

- تشخیص آهنگ‌های فارسی از طریق اثر انگشت صوتی
- پشتیبانی از انواع فرمت‌های صوتی (MP3, WAV, FLAC, OGG, M4A)
- جستجوی سریع در دیتابیس داخلی
- ارسال نسخه کامل آهنگ در صورت یافتن آن
- نمایش درصد شباهت برای هر نتیجه

## نیازمندی‌ها

برای اجرای این ربات به پیش‌نیازهای زیر نیاز دارید:

```
python 3.7+
python-telegram-bot
numpy
librosa
soundfile
scikit-learn
matplotlib
SQLAlchemy
tqdm
python-dotenv
```

## نصب و راه‌اندازی در محیط لوکال

1. ابتدا مخزن را کلون کنید:
```bash
git clone https://github.com/username/music-finder-bot.git
cd music-finder-bot
```

2. وابستگی‌ها را نصب کنید:
```bash
pip install -r requirements.txt
```

3. فایل `.env.example` را به `.env` تغییر نام دهید و آن را ویرایش کنید:
```bash
cp .env.example .env
nano .env  # یا هر ویرایشگر متنی دیگر
```

4. توکن ربات تلگرام و سایر تنظیمات را در فایل `.env` وارد کنید.

5. پوشه کتابخانه موسیقی را با فایل‌های آهنگ کامل پر کنید.

6. دیتابیس را با آهنگ‌های خود ایندکس‌گذاری کنید:
```bash
python indexer.py --dir path/to/your/music --clear
```

7. ربات را اجرا کنید:
```bash
python bot.py
```

## راه‌اندازی روی سرور لینوکس

1. ابتدا مخزن را روی سرور کلون کنید:
```bash
git clone https://github.com/username/music-finder-bot.git
cd music-finder-bot
```

2. یک محیط مجازی پایتون ایجاد کنید:
```bash
python3 -m venv venv
source venv/bin/activate
```

3. وابستگی‌ها را نصب کنید:
```bash
pip install -r requirements.txt
```

4. فایل `.env` را ایجاد کنید و تنظیمات را وارد کنید:
```bash
cp .env.example .env
nano .env
```

5. پوشه کتابخانه موسیقی را ایجاد کنید و آهنگ‌های خود را آپلود کنید:
```bash
mkdir -p music_folder
# آهنگ‌های خود را به سرور آپلود کنید - مثلا با استفاده از scp یا rsync
```

6. دیتابیس را ایندکس‌گذاری کنید:
```bash
python indexer.py --dir music_folder --clear
```

7. استفاده از tmux یا screen برای نگه داشتن ربات در حالت اجرا:
```bash
tmux new -s music_bot
python bot.py
```
سپس با فشردن `Ctrl+B` و سپس `D` می‌توانید از جلسه tmux خارج شوید و ربات همچنان در پس‌زمینه اجرا خواهد شد.

8. برای بازگشت به جلسه ربات:
```bash
tmux attach -t music_bot
```

## نحوه استفاده

1. در تلگرام، با ربات خود چت کنید
2. یک فایل صوتی از آهنگ ریمیکس شده ارسال کنید (می‌تواند یک قطعه کوتاه باشد)
3. ربات این فایل را پردازش کرده و سعی می‌کند آهنگ اصلی را در دیتابیس پیدا کند
4. اگر آهنگ مشابهی پیدا شود، ربات فایل کامل آن را برای شما ارسال می‌کند

## نکات مهم

- کیفیت تشخیص به کیفیت صوتی دمو و کیفیت دیتابیس شما بستگی دارد
- نام فایل‌های موسیقی شما بهتر است به فرمت `Artist - Title.mp3` باشد تا متادیتا به درستی استخراج شود
- برای نتیجه بهتر، سعی کنید دمو حداقل 10 ثانیه طول داشته باشد
- **امنیتی**: هرگز توکن ربات تلگرام خود را مستقیماً در کد قرار ندهید. همیشه از فایل `.env` استفاده کنید.

## ساختار پروژه

- `bot.py`: فایل اصلی ربات تلگرام
- `audio_fingerprint.py`: کد مربوط به پردازش صوتی و استخراج اثر انگشت
- `database.py`: مدیریت دیتابیس آهنگ‌ها
- `indexer.py`: اسکریپت ایندکس‌گذاری کتابخانه موسیقی
- `config.py`: تنظیمات ربات
- `.env`: فایل تنظیمات محیطی (حاوی اطلاعات حساس)

## لایسنس

این پروژه تحت لایسنس MIT منتشر شده است. 